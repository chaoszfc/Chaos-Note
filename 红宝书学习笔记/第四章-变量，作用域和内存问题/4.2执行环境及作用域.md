## 4.2执行环境及作用域

#### 执行环境（为简单起见，有时也称为“环境”）是javaScript中最为重要的一个概念。执行环境定义了变量或函数有权访问的其他数据。决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象（variable object）。环境中定义的所有变量和函数都保存在这个对象中。虽然我们编写的代码无法访问这个对象。但解析器在处理数据时会在后台使用它。

#### 全局执行环境是最外围的一个执行对象。根据ECMAScript实现所在的宿主环境不同。表示执行环境的对象也不一样。在web浏览器中。全局执行环境被认为是window对象。因此所有全局变量和函数都是作为window对象的属性和方法创建的。某个执行环境中的所有代码执行完毕后。该环境被销毁。

#### 每个函数都有自己的执行环境。当执行流进入一个函数时。函数的环境就会被推入一个环境栈中。而在函数执行后。栈将其环境弹出。把控制权返回给之前的执行环境。

#### `当代码在一个环境中执行时。会创建变量对象的一个作用域链。作用域链的用途，是保证对执行环境有权访问的所有变量和函数的有序访问。作用域的前端，始终都是当前执行的代码所在环境的变量对象。如果这个环境是函数，则其活动对象作为变量对象。活动对象在最开始时只包含一个变量，即arguments对象。作用域链中的下一个变量对象来自（外部）环境。而再一个变量对象则来自。而再下一个变量对象则来自下一个包含环境。这样，一直延续到全局执行环境。全部执行环境的对象始终是作用域链中的最后一个对象`
```
var color = "blue";
function changeColor(){
    if(color === "bule"){
        color = "red";
    }else{
        color = "blue";
    }
    console.log(color)
}
changeColor();  //red
alert(color);   //red
调用changeColor(),在changeColor作用域里找，没找到color。一直沿着作用域链找。找到color = blue。
```
#### 此外，在局部作用域中定义的变量可以在局部环境中与全局变量互换使用，如下面栗子所示：
```
var color = "blue";
function changeColor(){
    var anontherColor = "red";
    
    function swapColors(){
        var tempColor = anontherColor;
        anontherColor = color;
        color = tempColor;

        //这里可以访问color,anontherColor和tempColor
    }
    //这里可以访问color和anontherColor，但不能访问tempColor
    swapColors();
}
//这里只能访问color
changeColor();
```

#### 以上代码总共涉及3个执行环境：全局环境，changeColor()的局部环境和swapColors()的局部环境。全局环境中有一个变量color和一个函数changeColor()。changeColor()的局部环境中有一个名为anontherColor的变量和一个名为swapColors()的函数。但它也可以访问全局环境中的变量color。swapColors()的局部环境中有一个变量tempColor。该变量只能在这个环境中才能访问到。无论全局环境还是changeColor()的局部环境都无权访问tempColor。然而，在swapColors()内部则可以访问其他两个环境中的所有变量。因为那两个环境是它的父执行环境。
![Image text](../红宝书img/color作用域链.jpg)

----

### 4.2.1延长作用域链


